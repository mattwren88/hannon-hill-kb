<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>How to update deprecated Velocity code - Cascade CMS Knowledge Base</title>
		<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
		<link href="https://www.hannonhill.com/cascadecms/latest/_files/images/apple-touch-icon-57x57.png" name="favicon" rel="shortcut icon" type="image/png"/>
		
  <link href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/style.css" rel="stylesheet"/>
  <link href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/custom.css" rel="stylesheet"/>
  <link href="https://www.hannonhill.com/cascadecms/latest/_files/lib/prettify/prettify.css" rel="stylesheet"/>
  <link href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/prism/prism.css" rel="stylesheet" type="text/css"/>
  <link href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/lib/fonts/fontawesome-all.css" rel="stylesheet"/>
  
  <!-- Preload Font Awesome fonts -->
  <link as="font" crossorigin="anonymous" href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/lib/fonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="anonymous" href="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/lib/fonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>

 <!-- Conditional comment for IE 7 -->
<!--[if IE 7]>
   <link rel="stylesheet" href="/_files/lib/bootstrap/font-awesome-ie7.css">
<![endif]-->
<link href="https://customer.cludo.com/css/templates/v2.1/essentials/cludo-search.min.css" rel="stylesheet" type="text/css"/>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" type="text/javascript"></script>
		
<!-- Google Tag Manager -->

<script>
  dataLayer = [];
</script>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WQQX65');</script>

<!-- End Google Tag Manager -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/lib/prettify/prettify.js" type="text/javascript"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/lib/prettify/lang-css.js" type="text/javascript"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/lib/prettify/lang-sql.js" type="text/javascript"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/lib/prettify/lang-yaml.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() { prettyPrint(); });
</script>

		<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
		<link href="https://www.hannonhill.com/cascadecms/latest/faqs/development/update-deprecated-velocity-code.html" rel="canonical"/>
		<meta content="65b03082c0a80079701c39625c85fb60" name="id"/>
	</head>
	<body data-spy="scroll" data-target=".release-sidebar">
	    <a class="sr-only sr-only-focusable" href="#main-content">Skip to main content</a>
<a class="sr-only sr-only-focusable" href="#sidebar">Skip to sidebar / page navigation</a>
		<!-- Google Tag Manager (noscript) --><noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-WQQX65" style="display:none;visibility:hidden" width="0"></iframe></noscript><!-- End Google Tag Manager (noscript) -->
		

<nav aria-labelledby="navbar-brand" class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="https://www.hannonhill.com/cascadecms/latest/index.html" id="navbar-brand" name="brand"><img alt="Cascade CMS Logo" src="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/_images/kb-logo-new.png"/></a>
    <button aria-controls="navbarCollapse" aria-expanded="false" aria-label="toggle navigation" class="navbar-toggler" data-target="#navbarCollapse" data-toggle="collapse" type="button">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav ml-auto">


        
                
        
            <li class="nav-item"><a class="nav-link" href="https://www.hannonhill.com/cascadecms/latest/releases/index.html">Release Notes</a></li>
    
        
                
        
            <li class="nav-item"><a class="nav-link" href="https://help.hannonhill.com/hc/en-us">Support</a></li>
                </ul>
            <nav>
    <form class="form-inline search-bar" id="cludo-search-form-top" role="search">
        <div class="search-box">
        <input aria-label="Search" autocomplete="off" class="form-control form-control-sm search-input" id="searchBox" name="q" placeholder="Search..." type="search"/>
        <a class="search-btn" href="#" id="cludo-voice-parent" type="button">
            <i class="fa-solid fa-magnifying-glass"></i>
        </a>
        </div>
    </form>
</nav>
        </div>
    </nav>


		<div class="container">
			<div class="content-wrapper">
				



<nav aria-label="breadcrumb">
    <ol class="breadcrumb">

        
               <li class="breadcrumb-item"><a href="https://www.hannonhill.com/cascadecms/latest/index.html">            Home    
    </a></li>
      
        
               <li class="breadcrumb-item"><a href="https://www.hannonhill.com/cascadecms/latest/faqs/index.html">            FAQs    
    </a></li>
      
        
                           <li class="breadcrumb-item"><a href="https://www.hannonhill.com/cascadecms/latest/faqs/development/index.html">            Development    
    </a></li>
           <li aria-current="page" class="breadcrumb-item active">How to update deprecated Velocity code</li>
             
    </ol>
</nav>
				<div class="row">
					<main class="col-sm-12 col-md-12" id="main-content" role="main">
						
						


<style>
    main{
        display: flex;
        flex-direction: column;
        gap: 1em;
    }
</style>

        <div class="card shadow-big center width" id="expand">
                        <div class="icon-wrapper">
        <i class="fa-solid col-visible-md fa-up-right-and-down-left-from-center" id="iconToggle" onclick="toggleWidthAndIcon()"></i>
    </div>
            <div class="flex">
            <span class="badge badge-danger">Development</span>
        </div>
        <header>
                            <h1>How to update deprecated Velocity code 
                                        </h1>
                    </header>
      <a name="How+to+update+deprecated+Velocity+code"></a>
    
                        
                                                
            <section aria-label="" class="anchor-heading" id="">
                                    <h2>$_FieldTool.in("com.hannonhill.cascade.model.dom.identifier.EntityTypes")</h2>
<p>The <code>$_FieldTool.in(String)</code> method was used to obtain reference to entity types in order to locate assets using the Locator Tool. New methods added to the <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#LocatorTool" rel="nofollow noopener noreferrer" target="_blank">Locator Tool</a> allow for locating each type of asset.</p>
<h3>Examples</h3>
<pre><code>$_.locate($currentPagePath, $_FieldTool.in("com.hannonhill.cascade.model.dom.identifier.EntityTypes").TYPE_PAGE, $currentPageSiteName)</code></pre>
<pre><code>$_.locate("path/to/format", $_FieldTool.in("com.hannonhill.cascade.model.dom.identifier.EntityTypes").TYPE_FORMAT, $currentPageSiteName)</code></pre>
<pre><code>$endCal.add( $_FieldTool.in("java.util.Calendar").YEAR, $numberOfYearsToDisplay )</code></pre>
<pre><code>#set ( $System = $String.class.forName('java.lang.System') )<br/>#set ( $newLine = $System.getProperty('line.separator')<br/>#set ( $title = $title.replaceAll($newLine, '') )</code></pre>
<h3>Replacements</h3>
<pre><code>$currentPage</code></pre>
<pre><code>$_.locateFormat("path/to/format")</code></pre>
<pre><code>$endCal.add( $_FieldTool.in($endCal).YEAR, $numberOfYearsToDisplay )</code></pre>
<pre><code>#set ( $title = $title.replaceAll($_EscapeTool.n, '') )</code></pre>
<h2>Generating a random content</h2>
<p>The <code>java.util.UUID</code> , <code>org.apache.commons.codec.digest.DigestUtils</code> and <code>java.util.Random</code> classes were often used to generate random strings or UUIDs. A common use case is to generate unique DOM element identifiers.</p>
<p>A new method, <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_StringTool_generateUUID" rel="nofollow noopener noreferrer" target="_blank">generateUUID()</a>, added to the String Tool generates random UUID strings and there is an existing Math Tool method, <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_MathTool_random" rel="nofollow noopener noreferrer" target="_blank">random()</a>, that can generate random numbers.</p>
<h3>Examples</h3>
<pre><code>#set($id = "video-${class.forName('java.util.UUID').randomUUID().toString()}")<br/>...<br/>&lt;div id="${id}"&gt;<br/>...<br/>&lt;/div&gt;</code></pre>
<pre><code>$class.forName('java.util.Random').newInstance().nextInt(9999999)</code></pre>
<h3>Replacements</h3>
<pre><code>&lt;div id="video-${_StringTool.generateUUID()}"&gt;<br/>...<br/>&lt;/div&gt;</code></pre>
<pre><code>$_MathTool.random(0, 9999999)</code></pre>
<h2>Unescaping content</h2>
<p>The <code>org.apache.commons.lang.StringEscapeUtils</code> class was used as a way to unescape content that was previously escaped, such as HTML, XML, JavaScript, etc. <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_EscapeTool_unescapeHtml" rel="nofollow noopener noreferrer" target="_blank">New methods</a> added to the Escape Tool provide ways to unescape content.</p>
<h3>Example</h3>
<pre><code>$class.forName('org.apache.commons.lang.StringEscapeUtils').unescapeHtml("&amp;lt;br/&amp;gt;")<br/>## &lt;br/&gt;</code></pre>
<h3>Replacement</h3>
<pre><code>$_EscapeTool.unescapeHtml("&amp;lt;br/&amp;gt;")<br/>## &lt;br/&gt;</code></pre>
<h2>Regular expressions and pattern matching</h2>
<p>The <code>java.util.regex.Pattern</code> class was used to compile regular expressions for complex regular expression testing and group matching. A new <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#RegexTool" rel="nofollow noopener noreferrer" target="_blank">Regex Tool</a> provides a way to generate these pattern objects.</p>
<h3>Example</h3>
<pre><code>#set($_pattern = $class.forName("java.util.regex.Pattern"))<br/>#set( $_ids = $_pattern.compile("#([\w_-]+)").matcher($_s) )</code></pre>
<h3>Replacement</h3>
<pre><code>#set( $_ids = $_RegexTool.compile("#([\w_-]+)").matcher($_s) )</code></pre>
<h2>Concatenate strings using StringBuilder</h2>
<p>The <code> java.lang.StringBuilder</code> class was used as a way to concatenate strings together for outputting later, without introducing adding extra whitespace into the output. A <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_StringTool_getStringBuilder" rel="nofollow noopener noreferrer" target="_blank">new String Tool method</a> provides access to a <code>
														<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/StringBuilder.html" rel="nofollow noopener noreferrer" target="_blank">StringBuilder</a>
													</code> instance.</p>
<h3>Example</h3>
<pre><code>#set($sb = $class.forName('java.lang.StringBuilder').newInstance())<br/>#set ($sb = $sb.append('foo'))<br/>... <br/>${sb}</code></pre>
<h3>Replacement</h3>
<pre><code>#set($sb = $_StringTool.getStringBuilder())<br/>#set ($sb = $sb.append('foo'))<br/>... <br/>${sb}
</code></pre>
<h2>Checking Cascade asset type using getClass()</h2>
<p>The <code>getClass()</code> method was used as a way to access the underlying class of a given Cascade API object, such as combining with <code>getSimpleName()</code>. The Cascade API provides a way to access the asset type using <code>getAssetType()</code>.</p>
<h3>Example</h3>
<pre><code>#set ($chosenAsset = $currentPage.getStructuredDataNode("assetchooser").asset)<br/>#if ($chosenAsset.class.simpleName == "PageAPIAdapter")<br/>...<br/>#end</code></pre>
<h3>Replacement</h3>
<pre><code>#set ($chosenAsset = $currentPage.getStructuredDataNode("assetchooser").asset)<br/>#if ($chosenAsset.assetType == "page")<br/>...<br/>#end
</code></pre>
<h2>Checking data structure type using getClass()</h2>
<p>The <code>getClass()</code> method was used as a way to access the underlying class of a given object, such as combining with <code>getSimpleName()</code>. Various methods have been added to the <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_PropertyTool" rel="nofollow noopener noreferrer" target="_blank">Property Tool</a> to check data structure types: <code>isString</code>, <code>isMap</code>, <code>isList</code>, <code>isSet</code>, and <code>isIterable</code>.</p>
<h3>Example</h3>
<pre><code>#set($map = {})<br/>#if ($map.class.simpleName.contains("Map"))<br/>...<br/>#end</code></pre>
<h3>Replacement</h3>
<pre><code>#set($map = {})<br/>#if ($_PropertyTool.isMap($map))<br/>...<br/>#end
</code></pre>
<h2>Checking if an object is numeric using getClass()</h2>
<p>The <code>getClass()</code> method was used as a way to check if a given object is numeric. A method has been added to the <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_NumberTool" rel="nofollow noopener noreferrer" target="_blank">Number Tool</a> to check if a given object is numeric.</p>
<h3>Example</h3>
<pre><code>#set($number = 3)<br/>#if ($number.class.forName('java.lang.Number'))<br/>...<br/>#end</code></pre>
<h3>Replacement</h3>
<pre><code>#set($number = 3)<br/>#if ($_NumberTool.isNumeric($number))<br/>...<br/>#end
</code></pre>
<h2>Converting a map to JSON string</h2>
<p>A new <a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html#_SerializerTool.toJson" rel="nofollow noopener noreferrer" target="_blank">$_StringTool.toJson</a> method was added to allow for easily outputting a Map as a JSON string.</p>
<h3>Example</h3>
<pre><code>#set($map = {"test": "testing", "array": [1, 2, 3]})<br/>#foreach ($key in $map.keys)<br/>  #set ($value = $map.get($key))<br/>  ...<br/>#end</code></pre>
<h3>Replacement</h3>
<pre><code>#set($map = {"test": "testing", "array": [1, 2, 3]})<br/>$_SerializerTool.toJson($map)
</code></pre>
                                    </section>
                                     <a aria-label="Back to top" class="scroll-container" href="#top">
        <span class="scroll-container__icon">↑</span>
    </a>
  
        </div>
            <section aria-label="Related Links" class="card shadow-big center width" id="related-links ">
        <h2>Related Links</h2>
        <ul>
                            <li><a href="https://www.hannonhill.com/cascadecms/latest/developing-in-cascade/script-formats/velocity-tools.html">Velocity Tools</a></li>
                    </ul>
    </section>
    
    <script>
      function toggleWidthAndIcon() {
        var element = document.getElementById("expand");
        var icon = document.getElementById("iconToggle");
    
        // Check if the content is currently full width
        if (element.classList.contains("width-full")) {
          // If yes, switch to "width" and update the icon to "expand"
          element.classList.remove("width-full");
          element.classList.add("width");
          icon.classList.remove('fa-down-left-and-up-right-to-center');
          icon.classList.add('fa-up-right-and-down-left-from-center');
        } else {
          // If not, switch to "width-full" and update the icon to "un-expand"
          element.classList.remove("width");
          element.classList.add("width-full");
          icon.classList.remove('fa-up-right-and-down-left-from-center');
          icon.classList.add('fa-down-left-and-up-right-to-center');
        }
      }
    </script>
    
						
					</main>
				</div>
			</div>
			<footer>
				<div class="footer-wrapper ">
    <div class="cludo-feedback"></div> 
<hr/>
<div class="footer-container">
    <div class="footer-left">
        <img alt="cascade cms icon" class="footer-logo" src="https://www.hannonhill.com/cascadecms/latest/_files/images/apple-touch-icon-57x57.png"/>
        
                <p class="" id="site-copyright">All content <a aria-hidden="true" class="quickedit" href="https://hannonhill.cascadecms.com/entity/open.act?id=65b03082c0a80079701c39625c85fb60&amp;type=page" tabindex="-1" target="_blank">©</a> 2026 <a href="https://www.hannonhill.com/index.html">Hannon Hill</a></p>
        
        
    </div>
    <div class="footer-right">
         <ul>
            <li><a href="https://www.hannonhill.com/about-us/about-hannon-hill.html">About us</a></li>
            <li><a href="https://www.hannonhill.com/about-us/join-our-team/index.html">Careers</a></li>
            <li><a href="https://www.hannonhill.com/documents/index.html">Compliance</a></li>
            <li><a href="https://www.hannonhill.com/resources/index.html">Resources</a></li>
            <li><a href="https://portal.productboard.com/gp4tteft4txh4nde2tnnnybl">Idea Portal</a></li>
            <li><a href="https://www.hannonhill.com/cascadecms/latest/sitemap.html">Site Index</a></li>
            <li><a href="https://github.com/hannonhill">Github</a></li>
        </ul>
    </div>
</div>
</div>
			</footer>
		</div>
		
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/lib/bootstrap/bootstrap.min.js"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/lib/bootstrap/scrollspy.js"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/application.js"></script>
<script src="https://www.hannonhill.com/cascadecms/latest/_files/_redesign/prism/prism.js" type="text/javascript"></script>
<script src="https://customer.cludo.com/scripts/bundles/search-script.min.js" type="text/javascript"></script>
<script>
var CludoSearch;
(function () {
    var cludoSettings = {
        customerId: 10001479,
        engineId: 10002755,
        searchUrl: 'https://www.hannonhill.com/cascadecms/latest/search.html',
        language: 'en',
        searchInputs: ['cludo-search-form', 'cludo-search-form-top'],
        hideSearchFilters: true,
        focusOnResultsAfterSearch: true,
        type: 'inline',
        template: 'InlineBasic',
        disableAutocomplete: true,
        <!--enableVoiceSearch: true-->
    };
    CludoSearch = new Cludo(cludoSettings);
    CludoSearch.init();
})();
</script>
<!--Cludo Experiences-->
<script data-cid="10001479" defer="defer" id="cludo-experience-manager" src="https://customer.cludo.com/scripts/bundles/experiences/manager.js"></script>
<!--[if lte IE 9]>
    <script src="https://api.cludo.com/scripts/xdomain.js" slave="https://api.cludo.com/proxy.html" type="text/javascript"></script>
<![endif]-->


		
<script type="text/javascript">
    piAId = '1002';
    piCId = '1003';
    
    (function() {
        function async_load(){
            var s = document.createElement('script'); s.type = 'text/javascript';
            s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
            var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
        }
        if(window.attachEvent) { window.attachEvent('onload', async_load); }
        else { window.addEventListener('load', async_load, false); }
    })();
</script>
<script type="text/javascript">
  sAId = "1";
  sCId = "4";

  (function() {
    function async_load(){
      var s = document.createElement('script'); s.type = 'text/javascript';
      s.src = (('https:' == document.location.protocol) ? "https://ssl" : "http://cdn") + ".spectate.com/s.js";
      var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
    }
    if(window.attachEvent) { window.attachEvent('onload', async_load); }
    else { window.addEventListener('load', async_load, false); }
  })();
</script>


	    <script async="true" src="https://live.clive.cloud/page-views/track/12"></script>
		
	</body>
</html>